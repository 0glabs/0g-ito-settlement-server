# ZK-Settlement Agent API Documentation

This document outlines the API endpoints for the ZK-Settlement agent.

## Base URL

The base URL depends on the server configuration:

- HTTP: `http://0.0.0.0:<port>`
- HTTPS: `https://0.0.0.0:<port>`

Where `<port>` is the port number specified when starting the server.

## Endpoints

### 1. Get Verification Key

Retrieves the verification key.

- **URL:** `/vkey`
- **Method:** `GET`
- **Success Response:**
  - **Code:** 200
  - **Content:** Verification key object

- **Example:** 
```
curl -X GET http://localhost:3000/vkey
```

### 2. Generate Proof

Generates a zero-knowledge proof based on the provided inputs.

- **URL:** `/proof`
- **Method:** `POST`
- **Data Params:** 
  - JSON object containing input data
- **Success Response:**
  - **Code:** 200
  - **Content:** 
    ```json
    {
      "proof": [Proof data],
      "publicSignals": [Public signals]
    }
    ```
- **Example:**
```
curl -X POST -H "Content-Type: application/json" -d '{"signer":["180","3","122","144","208","176","91","143","75","134","62","196","168","170","61","152","15","25","152","242","201","223","26","226","233","238","29","178","149","21","65","158"],"r8":[["213","112","202","6","198","212","216","69","132","149","131","169","1","89","28","161","62","133","186","23","85","35","187","36","234","105","195","189","139","251","152","4"],["101","253","97","82","123","13","23","54","61","116","149","175","10","176","55","8","196","3","60","86","191","213","70","122","68","81","189","5","124","187","127","31"],["162","148","222","100","46","10","163","66","167","235","73","220","226","170","97","92","156","43","94","27","144","78","77","186","43","179","108","150","181","174","226","44"],["162","148","222","100","46","10","163","66","167","235","73","220","226","170","97","92","156","43","94","27","144","78","77","186","43","179","108","150","181","174","226","44"]],"s":[["117","235","97","124","207","210","27","13","48","35","128","62","100","33","18","31","94","158","117","110","28","118","129","255","206","17","134","250","55","99","183","3"],["247","173","126","46","178","95","153","10","60","59","144","229","51","182","6","27","64","203","120","183","173","169","241","87","209","198","214","188","76","171","178","3"],["250","20","69","80","96","193","33","225","117","97","180","184","236","128","55","82","72","74","43","203","142","191","19","67","206","10","126","206","83","2","84","4"],["250","20","69","80","96","193","33","225","117","97","180","184","236","128","55","82","72","74","43","203","142","191","19","67","206","10","126","206","83","2","84","4"]],"serializedRequest":[["1","0","0","0","1","0","0","0","0","0","0","0","1","0","0","0","0","0","0","0","0","244","81","194","140","1","0","0","0","80","120","199","140","1","0","0","239","205","171","144","120","86","52","18","239","205","171","144","120","86","52","18","205","171","239","205","171","239","205","171","239","205","171","239","205","171","239","205","171","239","205","171","144","120","86","52","18","144","120","86","52","18","144","120","86","52","18","144","120","86","52","18"],["2","0","0","0","1","0","0","0","2","0","0","0","1","0","0","0","0","0","0","0","0","244","81","194","140","1","0","0","232","83","120","199","140","1","0","0","239","205","171","144","120","86","52","18","239","205","171","144","120","86","52","18","205","171","239","205","171","239","205","171","239","205","171","239","205","171","239","205","171","239","205","171","144","120","86","52","18","144","120","86","52","18","144","120","86","52","18","144","120","86","52","18"],["3","0","0","0","0","0","0","0","1","0","0","0","1","0","0","0","0","0","0","0","0","244","81","194","140","1","0","0","208","87","120","199","140","1","0","0","239","205","171","144","120","86","52","18","239","205","171","144","120","86","52","18","205","171","239","205","171","239","205","171","239","205","171","239","205","171","239","205","171","239","205","171","144","120","86","52","18","144","120","86","52","18","144","120","86","52","18","144","120","86","52","18"],["4","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","232","102","94","111","1","0","0","0","180","197","218","184","1","0","0","239","205","171","144","120","86","52","18","239","205","171","144","120","86","52","18","205","171","239","205","171","239","205","171","239","205","171","239","205","171","239","205","171","239","205","171","144","120","86","52","18","144","120","86","52","18","144","120","86","52","18","144","120","86","52","18"]],"serializedAccount":["0","0","0","0","100","0","0","0","0","0","0","0","205","171","239","205","171","239","205","171","239","205","171","239","205","171","239","205","171","239","205","171","144","120","86","52","18","144","120","86","52","18","144","120","86","52","18","144","120","86","52","18"]}' http://localhost:3000/proof
```

### 3. Get Verifier Contract

Generates and returns the Solidity code for the verifier contract.

- **URL:** `/verifier-contract`
- **Method:** `GET`
- **Success Response:**
  - **Code:** 200
  - **Content:** Solidity code as plain text
- **Example:** 
```
curl -X GET http://localhost:3000/verifier-contract
```

### 4. Generate Solidity Calldata

Generates Solidity calldata based on the provided inputs.

- **URL:** `/solidity-calldata`
- **Method:** `POST`
- **Data Params:** 
  - JSON object containing input data
- **Success Response:**
  - **Code:** 200
  - **Content:** Solidity calldata as a JSON string
- **Example:**
```
curl -X POST -H "Content-Type: application/json" -d '{"signer":["180","3","122","144","208","176","91","143","75","134","62","196","168","170","61","152","15","25","152","242","201","223","26","226","233","238","29","178","149","21","65","158"],"r8":[["213","112","202","6","198","212","216","69","132","149","131","169","1","89","28","161","62","133","186","23","85","35","187","36","234","105","195","189","139","251","152","4"],["101","253","97","82","123","13","23","54","61","116","149","175","10","176","55","8","196","3","60","86","191","213","70","122","68","81","189","5","124","187","127","31"],["162","148","222","100","46","10","163","66","167","235","73","220","226","170","97","92","156","43","94","27","144","78","77","186","43","179","108","150","181","174","226","44"],["162","148","222","100","46","10","163","66","167","235","73","220","226","170","97","92","156","43","94","27","144","78","77","186","43","179","108","150","181","174","226","44"]],"s":[["117","235","97","124","207","210","27","13","48","35","128","62","100","33","18","31","94","158","117","110","28","118","129","255","206","17","134","250","55","99","183","3"],["247","173","126","46","178","95","153","10","60","59","144","229","51","182","6","27","64","203","120","183","173","169","241","87","209","198","214","188","76","171","178","3"],["250","20","69","80","96","193","33","225","117","97","180","184","236","128","55","82","72","74","43","203","142","191","19","67","206","10","126","206","83","2","84","4"],["250","20","69","80","96","193","33","225","117","97","180","184","236","128","55","82","72","74","43","203","142","191","19","67","206","10","126","206","83","2","84","4"]],"serializedRequest":[["1","0","0","0","1","0","0","0","0","0","0","0","1","0","0","0","0","0","0","0","0","244","81","194","140","1","0","0","0","80","120","199","140","1","0","0","239","205","171","144","120","86","52","18","239","205","171","144","120","86","52","18","205","171","239","205","171","239","205","171","239","205","171","239","205","171","239","205","171","239","205","171","144","120","86","52","18","144","120","86","52","18","144","120","86","52","18","144","120","86","52","18"],["2","0","0","0","1","0","0","0","2","0","0","0","1","0","0","0","0","0","0","0","0","244","81","194","140","1","0","0","232","83","120","199","140","1","0","0","239","205","171","144","120","86","52","18","239","205","171","144","120","86","52","18","205","171","239","205","171","239","205","171","239","205","171","239","205","171","239","205","171","239","205","171","144","120","86","52","18","144","120","86","52","18","144","120","86","52","18","144","120","86","52","18"],["3","0","0","0","0","0","0","0","1","0","0","0","1","0","0","0","0","0","0","0","0","244","81","194","140","1","0","0","208","87","120","199","140","1","0","0","239","205","171","144","120","86","52","18","239","205","171","144","120","86","52","18","205","171","239","205","171","239","205","171","239","205","171","239","205","171","239","205","171","239","205","171","144","120","86","52","18","144","120","86","52","18","144","120","86","52","18","144","120","86","52","18"],["4","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","232","102","94","111","1","0","0","0","180","197","218","184","1","0","0","239","205","171","144","120","86","52","18","239","205","171","144","120","86","52","18","205","171","239","205","171","239","205","171","239","205","171","239","205","171","239","205","171","239","205","171","144","120","86","52","18","144","120","86","52","18","144","120","86","52","18","144","120","86","52","18"]],"serializedAccount":["0","0","0","0","100","0","0","0","0","0","0","0","205","171","239","205","171","239","205","171","239","205","171","239","205","171","239","205","171","239","205","171","144","120","86","52","18","144","120","86","52","18","144","120","86","52","18","144","120","86","52","18"]}' http://localhost:3000/solidity-calldata
```

### 5. Generate Signature

Generates a signature for the provided data.

- **URL:** `/signature`
- **Method:** `POST`
- **Data Params:** JSON object containing data to be signed
- **Success Response:**
  - **Code:** 200
  - **Content:** 
    ```json
    {
      "signer": [Signer public key],
      "signatures": {
        "R8": [R8 component of signatures],
        "S": [S component of signatures]
      }
    }
    ```
- **Example:** 
```
curl -X POST -H "Content-Type: application/json" -d '{"requests":[{"nonce":1,"inputCount":1,"outputCount":0,"price":"10","updatedAt":"2024-01-01T00:00:00Z","createdAt":"2024-01-02T00:00:00Z","serviceName":"0x1234567890abcdef1234567890abcdef","userAddress":"0xabcdefabcdefabcdefabcdefabcdefabcdefabcd","providerAddress":"0x1234567890123456789012345678901234567890"}],"privkey":[248,249,209,134,89,173,186,208,180,107,31,177,20,172,49,114,238,213,142,203,211,98,74,62,12,119,100,107,165,252,1,49]}' http://localhost:3000/signature
```

### 6. Generate Proof Input

Generates input for proof generation based on the provided data.

- **URL:** `/proof-input`
- **Method:** `POST`
- **Data Params:** JSON object containing necessary data for proof input generation
- **Success Response:**
  - **Code:** 200
  - **Content:** 
    ```json
    {
      "serializedRequest": [Serialized request data],
      "r8": [R8 component of signatures],
      "s": [S component of signatures],
      "serializedAccount": [Serialized account data]
    }
    ```
- **Example:** 
```
curl -X POST -H "Content-Type: application/json" -d '{"requests":[{"nonce":1,"inputCount":1,"outputCount":0,"price":"10","updatedAt":"2024-01-01T00:00:00Z","createdAt":"2024-01-02T00:00:00Z","serviceName":"0x1234567890abcdef1234567890abcdef","userAddress":"0xabcdefabcdefabcdefabcdefabcdefabcdefabcd","providerAddress":"0x1234567890123456789012345678901234567890"}],"account":{"balance":0,"nonce":100,"userAddress":"0xabcdefabcdefabcdefabcdefabcdefabcdefabcd","providerAddress":"0x1234567890123456789012345678901234567890"},"l":2,"privkey":[248,249,209,134,89,173,186,208,180,107,31,177,20,172,49,114,238,213,142,203,211,98,74,62,12,119,100,107,165,252,1,49]}' http://localhost:3000/proof-input
```

## Error Handling

All endpoints may return a 500 Internal Server Error if an unexpected error occurs. The error response will have the following format:

```json
{
  "status": "Error",
  "message": "Error message",
  "stack": "Stack trace (only in development mode)"
}