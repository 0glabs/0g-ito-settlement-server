# zkSettlement Agent API

This document outlines the API endpoints for the ZK-Settlement agent.

## Base URL

The base URL depends on the server configuration:

- HTTP: `http://0.0.0.0:<port>`
- HTTPS: `https://0.0.0.0:<port>`

Where `<port>` is the port number specified when starting the server.

## Endpoints

### 1. Generate Key Pair

Generates a new Ed25519 key pair.

- **URL:** `/sign-keypair`
- **Method:** `GET`
- **Success Response:**
  - **Code:** 200
  - **Content:** 
    ```json
    {
      "publicKey": [Signer private key],
      "privateKey": [Signer public key],
    }
    ```
**Example:**
```bash
curl http://localhost:3000/sign-keypair
```
```ouput
{"privkey":[115,207,153,233,130,53,126,224,210,141,150,42,168,70,164,94,49,94,236,143,159,216,173,159,196,220,158,41,61,148,167,28],"pubkey":[[217,103,123,135,208,96,62,180,218,54,233,228,161,242,2,99,10,91,87,163,149,168,253,18,253,137,178,144,179,183,112,22],[247,223,117,192,119,101,154,99,194,33,177,107,36,33,128,48,105,113,62,116,60,164,194,57,159,29,232,145,44,224,1,15]]}
```

### 2. Generate Signature

Generates signatures for the provided data.

- **URL:** `/signature`
- **Method:** `POST`
- **Data Params:** JSON object containing data to be signed
- **Success Response:**
  - **Code:** 200
  - **Content:** 
    ```json
    {
      "signer": [Signer public key],
      "signatures": {
        "R8": [R8 component of signatures],
        "S": [S component of signatures]
      }
    }
    ```
- **Example:** 
```bash
curl -X POST -H "Content-Type: application/json" -d '{"requests":[{"nonce":1,"inputCount":1,"outputCount":0,"price":"10","updatedAt":"2024-01-01T00:00:00Z","createdAt":"2024-01-02T00:00:00Z","serviceName":"0x1234567890abcdef1234567890abcdef","userAddress":"0xabcdefabcdefabcdefabcdefabcdefabcdefabcd","providerAddress":"0x1234567890123456789012345678901234567890"}],"privkey":[115,207,153,233,130,53,126,224,210,141,150,42,168,70,164,94,49,94,236,143,159,216,173,159,196,220,158,41,61,148,167,28]}' http://localhost:3000/signature
```
```ouput
{"signatures":[[205,19,95,103,208,73,246,142,13,109,241,192,166,197,235,160,114,214,217,69,187,192,27,109,175,213,110,42,39,160,238,166,206,12,213,207,38,237,218,36,221,192,167,218,238,68,247,246,46,24,168,40,124,81,75,194,255,226,190,35,248,77,203,5]]}
```

### 3. Check Signature

Check signatures if valid.

- **URL:** `/check-sign`
- **Method:** `POST`
- **Data Params:** JSON object containing data to be signed, signatures and pubkey
- **Success Response:**
  - **Code:** 200
  - **Content:** 
    ```
    [bool]
    ```
- **Example:** 
```bash
curl -X POST -H "Content-Type: application/json" -d '{"requests":[{"nonce":1,"inputCount":1,"outputCount":0,"price":"10","updatedAt":"2024-01-01T00:00:00Z","createdAt":"2024-01-02T00:00:00Z","serviceName":"0x1234567890abcdef1234567890abcdef","userAddress":"0xabcdefabcdefabcdefabcdefabcdefabcdefabcd","providerAddress":"0x1234567890123456789012345678901234567890"}],"pubkey":[[217,103,123,135,208,96,62,180,218,54,233,228,161,242,2,99,10,91,87,163,149,168,253,18,253,137,178,144,179,183,112,22],[247,223,117,192,119,101,154,99,194,33,177,107,36,33,128,48,105,113,62,116,60,164,194,57,159,29,232,145,44,224,1,15]],"signatures":[[205,19,95,103,208,73,246,142,13,109,241,192,166,197,235,160,114,214,217,69,187,192,27,109,175,213,110,42,39,160,238,166,206,12,213,207,38,237,218,36,221,192,167,218,238,68,247,246,46,24,168,40,124,81,75,194,255,226,190,35,248,77,203,5]]}' http://localhost:3000/check-sign
```
```output
[true]
```

### 4. Generate Proof Input

Generates input for proof generation based on the provided data.

- **URL:** `/proof-input`
- **Method:** `POST`
- **Data Params:** JSON object containing necessary data for proof input generation
- **Success Response:**
  - **Code:** 200
  - **Content:** 
    ```json
    {
      "serializedRequest": [Serialized request data],
      "r8": [R8 component of signatures],
      "s": [S component of signatures],
      "serializedAccount": [Serialized account data]
    }
    ```
- **Example:** 
```bash
curl -X POST -H "Content-Type: application/json" -d '{"requests":[{"nonce":1,"inputCount":1,"outputCount":0,"price":"10","updatedAt":"2024-01-01T00:00:00Z","createdAt":"2024-01-02T00:00:00Z","serviceName":"0x1234567890abcdef1234567890abcdef","userAddress":"0xabcdefabcdefabcdefabcdefabcdefabcdefabcd","providerAddress":"0x1234567890123456789012345678901234567890"}],"account":{"balance":0,"nonce":100,"userAddress":"0xabcdefabcdefabcdefabcdefabcdefabcdefabcd","providerAddress":"0x1234567890123456789012345678901234567890"},"l":4,"pubkey":[[217,103,123,135,208,96,62,180,218,54,233,228,161,242,2,99,10,91,87,163,149,168,253,18,253,137,178,144,179,183,112,22],[247,223,117,192,119,101,154,99,194,33,177,107,36,33,128,48,105,113,62,116,60,164,194,57,159,29,232,145,44,224,1,15]],"signatures":[[205,19,95,103,208,73,246,142,13,109,241,192,166,197,235,160,114,214,217,69,187,192,27,109,175,213,110,42,39,160,238,166,206,12,213,207,38,237,218,36,221,192,167,218,238,68,247,246,46,24,168,40,124,81,75,194,255,226,190,35,248,77,203,5]]}' http://localhost:3000/proof-input
```
```output
{"serializedRequest":[["1","0","0","0","1","0","0","0","0","0","0","0","10","0","0","0","0","0","0","0","0","244","81","194","140","1","0","0","0","80","120","199","140","1","0","0","239","205","171","144","120","86","52","18","239","205","171","144","120","86","52","18","205","171","239","205","171","239","205","171","239","205","171","239","205","171","239","205","171","239","205","171","144","120","86","52","18","144","120","86","52","18","144","120","86","52","18","144","120","86","52","18"],["2","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","172","207","106","220","0","0","0","0","180","197","218","184","1","0","0","239","205","171","144","120","86","52","18","239","205","171","144","120","86","52","18","205","171","239","205","171","239","205","171","239","205","171","239","205","171","239","205","171","239","205","171","144","120","86","52","18","144","120","86","52","18","144","120","86","52","18","144","120","86","52","18"],["3","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","172","207","106","220","0","0","0","0","180","197","218","184","1","0","0","239","205","171","144","120","86","52","18","239","205","171","144","120","86","52","18","205","171","239","205","171","239","205","171","239","205","171","239","205","171","239","205","171","239","205","171","144","120","86","52","18","144","120","86","52","18","144","120","86","52","18","144","120","86","52","18"],["4","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","172","207","106","220","0","0","0","0","180","197","218","184","1","0","0","239","205","171","144","120","86","52","18","239","205","171","144","120","86","52","18","205","171","239","205","171","239","205","171","239","205","171","239","205","171","239","205","171","239","205","171","144","120","86","52","18","144","120","86","52","18","144","120","86","52","18","144","120","86","52","18"]],"r8":[["205","19","95","103","208","73","246","142","13","109","241","192","166","197","235","160","114","214","217","69","187","192","27","109","175","213","110","42","39","160","238","166"],["205","19","95","103","208","73","246","142","13","109","241","192","166","197","235","160","114","214","217","69","187","192","27","109","175","213","110","42","39","160","238","166"],["205","19","95","103","208","73","246","142","13","109","241","192","166","197","235","160","114","214","217","69","187","192","27","109","175","213","110","42","39","160","238","166"],["205","19","95","103","208","73","246","142","13","109","241","192","166","197","235","160","114","214","217","69","187","192","27","109","175","213","110","42","39","160","238","166"]],"s":[["206","12","213","207","38","237","218","36","221","192","167","218","238","68","247","246","46","24","168","40","124","81","75","194","255","226","190","35","248","77","203","5"],["206","12","213","207","38","237","218","36","221","192","167","218","238","68","247","246","46","24","168","40","124","81","75","194","255","226","190","35","248","77","203","5"],["206","12","213","207","38","237","218","36","221","192","167","218","238","68","247","246","46","24","168","40","124","81","75","194","255","226","190","35","248","77","203","5"],["206","12","213","207","38","237","218","36","221","192","167","218","238","68","247","246","46","24","168","40","124","81","75","194","255","226","190","35","248","77","203","5"]],"serializedAccount":["0","0","0","0","100","0","0","0","0","0","0","0","205","171","239","205","171","239","205","171","239","205","171","239","205","171","239","205","171","239","205","171","144","120","86","52","18","144","120","86","52","18","144","120","86","52","18","144","120","86","52","18"]}
```


### 5. Get Verification Key

Retrieves the verification key.

- **URL:** `/vkey`
- **Method:** `GET`
- **Success Response:**
  - **Code:** 200
  - **Content:** Verification key object

- **Example:** 
```bash
curl -X GET http://localhost:3000/vkey
```
```output
{"protocol":"groth16","curve":"bn128","nPublic":4,"vk_alpha_1":["20491192805390485299153009773594534940189261866228447918068658471970481763042","9383485363053290200918347156157836566562967994039712273449902621266178545958","1"],"vk_beta_2":[["6375614351688725206403948262868962793625744043794305715222011528459656738731","4252822878758300859123897981450591353533073413197771768651442665752259397132"],["10505242626370262277552901082094356697409835680220590971873171140371331206856","21847035105528745403288232691147584728191162732299865338377159692350059136679"],["1","0"]],"vk_gamma_2":[["10857046999023057135944570762232829481370756359578518086990519993285655852781","11559732032986387107991004021392285783925812861821192530917403151452391805634"],["8495653923123431417604973247489272438418190587263600148770280649306958101930","4082367875863433681332203403145435568316851327593401208105741076214120093531"],["1","0"]],"vk_delta_2":[["15215163651452012161592791490198849686900822241553895066633500590627144147933","15893598507508928981630514122816477424924626775537435683502768580816656792802"],["13952702057737622942335466937561409479025032464232227556917322374151913653951","37144773243664003271644573001925943845632569633748221010851963092507718953"],["1","0"]],"vk_alphabeta_12":[[["2029413683389138792403550203267699914886160938906632433982220835551125967885","21072700047562757817161031222997517981543347628379360635925549008442030252106"],["5940354580057074848093997050200682056184807770593307860589430076672439820312","12156638873931618554171829126792193045421052652279363021382169897324752428276"],["7898200236362823042373859371574133993780991612861777490112507062703164551277","7074218545237549455313236346927434013100842096812539264420499035217050630853"]],[["7077479683546002997211712695946002074877511277312570035766170199895071832130","10093483419865920389913245021038182291233451549023025229112148274109565435465"],["4595479056700221319381530156280926371456704509942304414423590385166031118820","19831328484489333784475432780421641293929726139240675179672856274388269393268"],["11934129596455521040620786944827826205713621633706285934057045369193958244500","8037395052364110730298837004334506829870972346962140206007064471173334027475"]]],"IC":[["11000352880506725146661685507380035706533802548284428908396799653851004456921","16461051887253598297496977652118715929466793341870087102924648618728465175552","1"],["9103425543961022054388019063335440123180704012750538145107685405360903433373","7306451228157247336491609710825895155300534266066007991517513110889642458085","1"],["15562350960492021579951510067962221854589456413886111818916844168679740805623","20923945419274409285477304728512119913855577172698742123861183181348280502380","1"],["5073366486673580787509316853947568286064869147288531382731263782547076565527","11866217021294858795335848859081190388600945793998447471387493206858420687285","1"],["21811606571933332521453633940306513134050671080940407753971725278701269013749","10000242794544356685645945537355293666958467130052441204303656703361018946925","1"]]}
```

### 6. Generate Proof

Generates a zero-knowledge proof based on the provided inputs.

- **URL:** `/proof`
- **Method:** `POST`
- **Data Params:** 
  - JSON object containing input data
- **Success Response:**
  - **Code:** 200
  - **Content:** 
    ```json
    {
      "proof": [Proof data],
      "publicSignals": [Public signals]
    }
    ```
- **Example:**
```bash
curl -X POST -H "Content-Type: application/json" -d '{"serializedRequest":[["1","0","0","0","1","0","0","0","0","0","0","0","10","0","0","0","0","0","0","0","0","244","81","194","140","1","0","0","0","80","120","199","140","1","0","0","239","205","171","144","120","86","52","18","239","205","171","144","120","86","52","18","205","171","239","205","171","239","205","171","239","205","171","239","205","171","239","205","171","239","205","171","144","120","86","52","18","144","120","86","52","18","144","120","86","52","18","144","120","86","52","18"],["2","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","172","207","106","220","0","0","0","0","180","197","218","184","1","0","0","239","205","171","144","120","86","52","18","239","205","171","144","120","86","52","18","205","171","239","205","171","239","205","171","239","205","171","239","205","171","239","205","171","239","205","171","144","120","86","52","18","144","120","86","52","18","144","120","86","52","18","144","120","86","52","18"],["3","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","172","207","106","220","0","0","0","0","180","197","218","184","1","0","0","239","205","171","144","120","86","52","18","239","205","171","144","120","86","52","18","205","171","239","205","171","239","205","171","239","205","171","239","205","171","239","205","171","239","205","171","144","120","86","52","18","144","120","86","52","18","144","120","86","52","18","144","120","86","52","18"],["4","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","172","207","106","220","0","0","0","0","180","197","218","184","1","0","0","239","205","171","144","120","86","52","18","239","205","171","144","120","86","52","18","205","171","239","205","171","239","205","171","239","205","171","239","205","171","239","205","171","239","205","171","144","120","86","52","18","144","120","86","52","18","144","120","86","52","18","144","120","86","52","18"]],"signer":["53","148","163","184","13","22","109","122","44","168","114","59","152","103","157","242","16","61","101","195","36","79","245","58","71","193","206","223","209","250","149","157"],"r8":[["205","19","95","103","208","73","246","142","13","109","241","192","166","197","235","160","114","214","217","69","187","192","27","109","175","213","110","42","39","160","238","166"],["205","19","95","103","208","73","246","142","13","109","241","192","166","197","235","160","114","214","217","69","187","192","27","109","175","213","110","42","39","160","238","166"],["205","19","95","103","208","73","246","142","13","109","241","192","166","197","235","160","114","214","217","69","187","192","27","109","175","213","110","42","39","160","238","166"],["205","19","95","103","208","73","246","142","13","109","241","192","166","197","235","160","114","214","217","69","187","192","27","109","175","213","110","42","39","160","238","166"]],"s":[["206","12","213","207","38","237","218","36","221","192","167","218","238","68","247","246","46","24","168","40","124","81","75","194","255","226","190","35","248","77","203","5"],["206","12","213","207","38","237","218","36","221","192","167","218","238","68","247","246","46","24","168","40","124","81","75","194","255","226","190","35","248","77","203","5"],["206","12","213","207","38","237","218","36","221","192","167","218","238","68","247","246","46","24","168","40","124","81","75","194","255","226","190","35","248","77","203","5"],["206","12","213","207","38","237","218","36","221","192","167","218","238","68","247","246","46","24","168","40","124","81","75","194","255","226","190","35","248","77","203","5"]],"serializedAccount":["0","0","0","0","100","0","0","0","0","0","0","0","205","171","239","205","171","239","205","171","239","205","171","239","205","171","239","205","171","239","205","171","144","120","86","52","18","144","120","86","52","18","144","120","86","52","18","144","120","86","52","18"]}' http://localhost:3000/proof
```
```output
{"proof":{"pi_a":["5621456052641123268940486201745830232857975702995854417381195721376463899356","10106749903153963788339532490876490253725331408551214039410934716861758908039","1"],"pi_b":[["2307375345781593873532853319200574915418512508674471616456978288607959622126","10042545061599731967527415736436833422235154138418676028244296260162755450737"],["17521862620554507195998828176161971857344948108841318390376272156408815402456","17175504856371240597243075339224408443627633371530569291989197538910146942969"],["1","0"]],"pi_c":["2660627277715208057983519378629103806558411785363817848456169676412225669464","7324977555923128036800040436767566691049955965807393560895737509295610901563","1"],"protocol":"groth16","curve":"bn128"},"publicSignals":["67508805047955878655522138659836237586","217179340878883550872036538015305384220","4","90"]}
```

### 7. Get Verifier Contract

Generates and returns the Solidity code for the verifier contract.

- **URL:** `/verifier-contract`
- **Method:** `GET`
- **Success Response:**
  - **Code:** 200
  - **Content:** Solidity code as plain text
- **Example:** 
```bash
curl -X GET http://localhost:3000/verifier-contract
```

### 8. Generate Solidity Calldata

Generates Solidity calldata based on the provided inputs.

- **URL:** `/solidity-calldata`
- **Method:** `POST`
- **Data Params:** 
  - JSON object containing input data
- **Success Response:**
  - **Code:** 200
  - **Content:** Solidity calldata
- **Example:**
```bash
curl -X POST -H "Content-Type: application/json" -d '{"serializedRequest":[["1","0","0","0","1","0","0","0","0","0","0","0","10","0","0","0","0","0","0","0","0","244","81","194","140","1","0","0","0","80","120","199","140","1","0","0","239","205","171","144","120","86","52","18","239","205","171","144","120","86","52","18","205","171","239","205","171","239","205","171","239","205","171","239","205","171","239","205","171","239","205","171","144","120","86","52","18","144","120","86","52","18","144","120","86","52","18","144","120","86","52","18"],["2","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","172","207","106","220","0","0","0","0","180","197","218","184","1","0","0","239","205","171","144","120","86","52","18","239","205","171","144","120","86","52","18","205","171","239","205","171","239","205","171","239","205","171","239","205","171","239","205","171","239","205","171","144","120","86","52","18","144","120","86","52","18","144","120","86","52","18","144","120","86","52","18"],["3","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","172","207","106","220","0","0","0","0","180","197","218","184","1","0","0","239","205","171","144","120","86","52","18","239","205","171","144","120","86","52","18","205","171","239","205","171","239","205","171","239","205","171","239","205","171","239","205","171","239","205","171","144","120","86","52","18","144","120","86","52","18","144","120","86","52","18","144","120","86","52","18"],["4","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","172","207","106","220","0","0","0","0","180","197","218","184","1","0","0","239","205","171","144","120","86","52","18","239","205","171","144","120","86","52","18","205","171","239","205","171","239","205","171","239","205","171","239","205","171","239","205","171","239","205","171","144","120","86","52","18","144","120","86","52","18","144","120","86","52","18","144","120","86","52","18"]],"signer":["53","148","163","184","13","22","109","122","44","168","114","59","152","103","157","242","16","61","101","195","36","79","245","58","71","193","206","223","209","250","149","157"],"r8":[["205","19","95","103","208","73","246","142","13","109","241","192","166","197","235","160","114","214","217","69","187","192","27","109","175","213","110","42","39","160","238","166"],["205","19","95","103","208","73","246","142","13","109","241","192","166","197","235","160","114","214","217","69","187","192","27","109","175","213","110","42","39","160","238","166"],["205","19","95","103","208","73","246","142","13","109","241","192","166","197","235","160","114","214","217","69","187","192","27","109","175","213","110","42","39","160","238","166"],["205","19","95","103","208","73","246","142","13","109","241","192","166","197","235","160","114","214","217","69","187","192","27","109","175","213","110","42","39","160","238","166"]],"s":[["206","12","213","207","38","237","218","36","221","192","167","218","238","68","247","246","46","24","168","40","124","81","75","194","255","226","190","35","248","77","203","5"],["206","12","213","207","38","237","218","36","221","192","167","218","238","68","247","246","46","24","168","40","124","81","75","194","255","226","190","35","248","77","203","5"],["206","12","213","207","38","237","218","36","221","192","167","218","238","68","247","246","46","24","168","40","124","81","75","194","255","226","190","35","248","77","203","5"],["206","12","213","207","38","237","218","36","221","192","167","218","238","68","247","246","46","24","168","40","124","81","75","194","255","226","190","35","248","77","203","5"]],"serializedAccount":["0","0","0","0","100","0","0","0","0","0","0","0","205","171","239","205","171","239","205","171","239","205","171","239","205","171","239","205","171","239","205","171","144","120","86","52","18","144","120","86","52","18","144","120","86","52","18","144","120","86","52","18"]}' http://localhost:3000/solidity-calldata
```
```output
["0x2d3d2348445e04ccff7913b6364a497aa7be52964df3b270c41c6f3fc645c919", "0x23edad868d11f7a6f6124e48cd33cce1977dd6741ea991657392916f8af3b0a7"],[["0x21f20a4dc4f95154ad3ec9a4a36f46db84df21e3fa9b92dac3e40508c063cebf", "0x21090071aa8ab17999b74df401946558b88b012607eaa45228cb25074c1bf177"],["0x1f4de93438655dfadf38e9349654d7b658b3e198747a00350e30c5fbbfa163fe", "0x2cd14f85a1a9de2d5445773ce9a923743cb35af91d3217e99e4e0777388b3e44"]],["0x174ed387bd3d6433f10db97d8cfa6d34aeacd05a75e6c80bf5c2255cf9dfdc13", "0x15bf8b3ceeb5cee9b3576558bde5c8d2ab41198bb5cfdc58306b15f671c4dcce"],["0x0000000000000000000000000000000032c9b910f7e3120f30cde4ec83a59712","0x00000000000000000000000000000000a36338370e69b30c1a389a611a73411c","0x0000000000000000000000000000000000000000000000000000000000000004","0x000000000000000000000000000000000000000000000000000000000000005a"]
```

## Error Handling

All endpoints may return a 500 Internal Server Error if an unexpected error occurs. The error response will have the following format:

```json
{
  "status": "Error",
  "message": "Error message",
  "stack": "Stack trace (only in development mode)"
}